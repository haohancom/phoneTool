<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, user-scalable=no">
	<title>Web App Commands List</title>
	<link rel="stylesheet" type="text/css" href="./css/jquery.dataTables.min.css">
	<link rel="stylesheet" type="text/css" href="./css/demo.css">
	<link rel="stylesheet" type="text/css" href="./css/style.css">

	<script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
	<script type="text/javascript" language="javascript" src="./js/jquery.dataTables.min.js"></script>
	<script src="./js/jquery.ui.widget.js"></script>
	<script src="./js/jquery.iframe-transport.js"></script>

	<script>
		function deleteCommands(id) {
			$.ajax({
				type: 'DELETE',
				url: "/phone/tool/api/command",
				data: { "id": id },
				success: function (result) {
					window.location.reload();
				},
				error: function (result) {
					alert("command deleted failed ")
				}
			});
		}

		function analyseLogsDetail(id) {
			$.ajax({
				type: 'POST',
				url: "/pan/tool/api/log/analyse/" + id,
				success: function (result) {
					window.location.reload();
				},
				error: function (result) {
					alert("Row ANALYSE failed ")
				}

			});
		}

		function insertCommand(json) {
			$.ajax({
				type: 'POST',
				url: "/phone/tool/api/command",
				data: json,
				contentType: "application/json",
				success: function (result) {
					window.location.reload();
				},
				error: function (result) {
					alert("command insert failed !")
				}

			});
		}

		function viewLogsDetail(id) {
			var analysewin = window.open('area-simple-time.html?id=' + id);
			console.log("view log,id=" + id);
		}

		function getCommandsTable(){
			$('#Commands').DataTable({
				"paging": false,
				"ordering": false,
				"info": false,
				"ajax": "/phone/tool/api/commands",
				columns: [
					{
						data: "request"
					},
					{
						data: "response"
					},
					{
						data: "delay"
					},
					{
						data: "sender"
					},
					{
						data: "receiver"
					},
					{
						data: "function_name"
					},
					{
						data: "description",
						render: function (data, type, row, meta) {
							var actionHtml;
							// if (row.sender === "server") {
							// 	actionHtml = '<a href=javascript:viewLogsDetail("' + row.uuid + '")>View</a> ';
							// }

							// actionHtml = actionHtml + ' | <a href=javascript:deleteCommands("' + row.request + '")>Delete</a>';
                            var id = row.request.replaceAll("\\", "\\\\");
							actionHtml = ' | <a href=javascript:deleteCommands("' + id + '")>Delete</a>';
                            return actionHtml;
						}
					}
				]
			});

		}
		$(document).ready(function () {
			getCommandsTable();

			$("#insert").click(function() {
				var json = $("#command_json").val();
				insertCommand(json);
			})

		});

	</script>
</head>

<body class="dt-example">

<div class="container">
	<div id="inputbox">
		<p>please input Commands info to create Commands</p>
		<p>commands_info : <input id="command_json" type="text"></p>
		<p>e.g. : { "request": "S010\\n", "response": "OK\\n", "delay": "", "sender": "client", "receiver": "server", "function_name": "关闭LED光源", "description": "通知下位机关闭外观测试用的光源" }</p>
	</div>
	<button id="insert" class="ui-button ui-widget ui-corner-all">insert</button>

	<table id="Commands" class="display" style="width:100%">
		<thead>
		<tr>
			<th>request</th>
			<th>response</th>
			<th>delay</th>
			<th>sender</th>
			<th>receiver</th>
			<th>function_name</th>
			<th>description</th>
		</tr>
		</thead>
	</table>
</div>
</body>
</html>